---
  layout : post
  title : Codec2语音编码器1 相关数据类型
  tag : Codec2
---
## CODEC 结构体

结构体 **CODEC** 的定义在 *codec_internal.h* 文件中。
结构体 **CODEC** 包含了 Codec2 解码器所用到的所有有关数据，
无论是编码还是解码过程中所需要的数据都包含在这个结构体之中。

{% highlight C %}
struct CODEC2 {
    int           mode;
    kiss_fft_cfg  fft_fwd_cfg;             /* FFT 设置                                  */
    float         w[M];                    /* 时域hamming 窗                            */
    COMP          W[FFT_ENC];              /* w[] 的 DFT                                */
    float         Pn[2*N];                 /* 梯形合成窗口                              */
    float        *bpf_buf;                 /* 带通滤波器缓冲区                          */
    float         Sn[M];                   /* 输入语音序列                              */
    float         hpf_states[2];           /* 高通滤波器状态                            */
    void         *nlp;                     /* 基音预测器状态                            */
    int           gray;                    /* 非零格雷编码                              */
    
    kiss_fft_cfg  fft_inv_cfg;             /* 逆 FFT 设置                               */
    float         Sn_[2*N];                /* 合成语音输出                              */
    float         ex_phase;                /* 激励模型相位轨迹                          */
    float         bg_est;                  /* 后处理滤波器的后端噪声估计                */
    float         prev_Wo_enc;             /* 之前帧的基音估计                          */
    MODEL         prev_model_dec;          /* 之前帧的模型参数                          */
    float         prev_lsps_dec[LPC_ORD];  /* 之前帧的LSP参数                           */
    float         prev_e_dec;              /* previous frame's LPC energy               */

    int           lpc_pf;                  /* LPC 后处理滤波器开启                      */
    int           bass_boost;              /* LPC 后处理滤波器低音提升                  */
    float         beta;                    /* LPC 后处理滤波器参数                      */
    float         gamma;

    float         xq_enc[2];               /* 基音与能量协同 VQ 状态                    */
    float         xq_dec[2];

    int           smoothing;               /* 对于通道误差使能平滑处理                  */
    float        *softdec;                 /* optional soft decn bits from demod        */
};
{% endhighlight %}

在 **CODEC** 结构体中出现的非标准类型有三个，分别是 **MODE** ， **kiss_fft_cfg** 和 **MODE** 。

## COMP 类型 

**COMP** 是复数结构体类型，它的定义在 *comp.h* 中。

{% highlight C %}
typedef struct { 
	float real;
	float imag;
} COMP;
{% endhighlight %}

## kiss\_fft\_cfg 类型

**kiss_fft_cfg** 是一个结构体指针类型，定义在 *kiss_fft.h* 中。
看这个名字就知道这个结构体指针和 FFT 的设置有关。

{% highlight C %}
	typedef struct kiss_fft_state* kiss_fft_cfg;
{% endhighlight %}

而 **kiss_fft_state** 结构体定义在 *kiss_fft_guts.h* 中。

{% highlight C %}
struct kiss_fft_state{
	int nfft;                            /* 猜测是 FFT 的点数   */
	int inverse;                         /* FFT 方向（正 or 逆）*/
	int factors[2*MAXFACTORS];           /* FFT 系数            */
	kiss_fft_cpx twiddles[1];
};
{% endhighlight %}

## MODE 类型

最后 **MODE** 结构体类型的定义在 *defines.h* 中。
这个结构体类型和语音模型有关。

{% highlight C %}
typedef struct {
	float Wo;             /* 基频估计（弧度单位）                       */
	int   L;              /* 谐波数                                     */
	float A[MAX_AMP+1];   /* 各次谐波的幅值                             */
	float phi[MAX_AMP+1]; /* 各次谐波的相位                             */
	int   voiced;         /* 如果这一帧是浊音，那么这个变量是非零的     */
} MODEL;
{% endhighlight %}

