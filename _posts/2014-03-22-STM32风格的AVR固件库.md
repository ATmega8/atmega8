---
layout : post
title : STM32风格的AVR固件库
tag : AVR
---

####起因

以前玩AVR，430的时候都是直接操作寄存器，玩STM32的时候用了ST的固件库，感觉十分方便，不用天天再抱着DS看了，而且还方便自动生成代码。
最近在论坛上看到说ST以后不打算搞固件库了，于是编写固件库的光荣任务就落到了开发人员的头上去了。
最近正在研究AVR单片机，于是就想按照ST的风格来写个AVR的固件库试试。

####STM32固件库的简单分析

下面的STM32固件库代码基于STM32F3固件库V1.0.0，其他版本的固件库应该类似。
以GPIO为例吧。
首先可以看到 *stm32f30x_gpio.h* 中定义了各种枚举结构，然后还定义了一个结构体。比如说：

{% highlight C %} 
typedef enum
{
  GPIO_PuPd_NOPULL = 0x00,
  GPIO_PuPd_UP     = 0x01,
  GPIO_PuPd_DOWN   = 0x02
}GPIOPuPd_TypeDef;
{% endhighlight %} 

还有：

{% highlight C %} 
typedef enum
{ 
  GPIO_Speed_2MHz   = 0x01, /*!< Medium Speed */
  GPIO_Speed_10MHz  = 0x02, /*!< Fast Speed   */
  GPIO_Speed_50MHz  = 0x03  /*!< High Speed   */
}GPIOSpeed_TypeDef;
{% endhighlight %} 

然后那个结构体是这样定义的：

{% highlight C %}
typedef struct
{
  uint32_t GPIO_Pin;              /*!< Specifies the GPIO pins to be configured.
                                       This parameter can be any value of @ref GPIO_pins_define */
                                       
  GPIOMode_TypeDef GPIO_Mode;     /*!< Specifies the operating mode for the selected pins.
                                       This parameter can be a value of @ref GPIOMode_TypeDef   */

  GPIOSpeed_TypeDef GPIO_Speed;   /*!< Specifies the speed for the selected pins.
                                       This parameter can be a value of @ref GPIOSpeed_TypeDef  */

  GPIOOType_TypeDef GPIO_OType;   /*!< Specifies the operating output type for the selected pins.
                                       This parameter can be a value of @ref GPIOOType_TypeDef  */

  GPIOPuPd_TypeDef GPIO_PuPd;     /*!< Specifies the operating Pull-up/Pull down for the selected pins.
                                       This parameter can be a value of @ref GPIOPuPd_TypeDef   */
}GPIO_InitTypeDef;
}
{% endhighlight %} 

发现没有，上面定义的枚举结构做为结构体的成员。然后枚举类型包含的是外设的基本状态，比如输入还是输出啊，推挽还是开漏啊。
外设的基本状态就包含在这个结构体之中了。


